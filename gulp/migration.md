# Задача: перевод установки пакетов фронтенда с менеджера пакетов bower на менеджер пакетов npm

Переход к установке пакетов с помощью менеджера пакетов npm производится путём обрабортки файлов bower.json, содержащих имена и версии необходимых пакетов и формирования файла package.json, с аналогичной информацией.
Все необходимые действия будут выполнены после запуска зажаний "bower:away" или последовательного запуска сначала "bower:parse", а затем "bower:package"

### Основные пункты

* [bower:parse](#bower:parse)
* [bower:package](#bower:package)
* [installPackagesFromGit](#installPackagesFromGit)
* [Дальнейшее развитие](#Дальнейшее_развитие)

## bower:parse

Это задание, которое формирует из всех файлов bower.json находящихся в директории запуска и всех поддиректория список пакетов, при этом каждый пакет будет сохранён из его git репозитория в папку TEMP системы в директорию bowerAway. Уже сохранённая версия пакета будет удалена. После сохранения пакета на компьютере, он будет пречислен к одной из трёх категорий: 1) Пакеты, с одинаковыми именами и в bower и в npm. 2) Пакеты с разными в bower и npm именами. 3) Пакеты, которых нет в npm.
После разделения пакетов, следует проверка первой группы на соответсвие версий. Как результ - первая группа будет разделена ещё на две: пакеты, у которых указанная версия существет в npm и те, у которых указанный релиз присутствует в репозитории, но не доступен в npm. В итоге все четыре группы будут сохранены в папке bowerPackagesInfo в директоии запуска. Каждый файл - это json, содержащий объект поля которого - названия пактов. Значения полей - это объекты с полями version, repository и data. Поле data доступно только для тех пакетов, которые присутствуют в npm.

## bower:package

В этом задании происходит непосредственное формирование файлов paсkage.json. Все поля bower.json, кроме dependencies копируются в package.json, в dependencies копируются только не требующие правок при переходе с bower на npm. Так же в поле "scripts"."preinstall" будет записан абсолютный путь к скрипту installPackagesFromGit. Если полей "scripts" или "preinstall" нет, они будут созданы.  
Пакеты не совпадающие в bower и npm записываются в файл missing.json, их установкой и будет заниматься скрипт installPackagesFromGit. 
Наконец, будет создан файл .npmignore, который исключит установку пакетов из директорий, в которых отсутствует package.json.

## installPackagesFromGit

Этот скрипт устанавливает bower пакеты, не имеющие аналога в npm, а так же те, которые не имеют в npm указанную в bower версию или имеют другое название. Установка происходит следующим образом:
1) Поиск и чтение файла missing.json. Если такого файла нет, скрипт завершает работу.
2) Проверкан наличия в текущей папке подпапки node_modules. Если её нет, она создаётся.
3) Для следующего поля в missing.json проеряем, есть ли директория с таким именем в node_modules, если есть, пропускаем установку пакета.
4) Копируем пакет из кэша (os.tmpdir() + 'bowerAway'), если он там есть, в противном случае, клонируем из репозитория.
5) Переходим на указанную версию (тэг). Если указанная версия не найдена, кидаем варнинг.
6) Удаляем папку .git.
7) Для каждого пакета в package.json проходим по полям dependendencies и peerDependencies и выполняем для каждого имени npm install ${имя}@${версия}, причём рабочая директория - папка, в которой запущен installPackagesFromGit. Почему так. В некоторых пакетах указаны файлы, которые должны остаться после выполнения команды "npm install". Возникла ситуация, когда ejs шаблон ссылается на удалённый файл.
8) Переходим на пункт 3. Если есть ошибка - выводим её, удаляем .git пакета.

## Дальнейшее развитие

Для того, чтобы исключить использование стороннего скрипта, необходимо записать имя пакета из missing.json в package.json и разрешить следующие проблемы: 
1) Обновить название пакета на корректное название из npm везде, где оно используется.
Имена, ссылка на репозитории и данные пакетов с разными для bower и npm именами находятся в файле ./gulp/bowerPackagesInfo/existNotEqual.json
2) Выставить подходящую для модуля или приложения версию пакета, которая присутствует в npm. Имена, ссылка на репозитории и данные пакетов с проблемами в версии находятся в файле ./gulp/bowerPackagesInfo/missingVersion.json
3) Для пакетов, отстутствующих в npm, найти альтернативу, изменить код и шаблоны, которые их используют. Имена и ссылка на репозитории находятся в файле ./gulp/bowerPackagesInfo/missing.json
