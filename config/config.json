{
    "log_level": "notice",
    "parametrised": true,
    "port": [
        "[[server.port1]]",
        "[[server.port2]]",
        "[[server.port3]]"
    ],
    "defaultModule":"[[module.default]]",
    "log": {
      "logDestinations": ["console", "./log"]
    },
    "di" : {
      "rtEvents": {
        "module": "core/RuntimeEvents",
        "options": {
          "target": "ion://server",
          "stopEvent": "close"
        }
      },
      "dataSources": {
        "module": "core/datasources",
        "initMethod": "connect",
        "initLevel": 0,
        "options": {
          "logger": "ion://sysLog",
          "runtimeEvents": "ion://rtEvents",
          "sources": [
            {
              "name":"Db",
              "module":"core/impl/datasource/mongodb",
              "options": {
                "logger": "ion://sysLog",
                "uri": "[[db.uri]]",
                "options": {
                  "server": {
                    "socketOptions":{
                      "keepAlive": 1
                    }
                  }
                },
                "connectionLimit": 10,
                "user": "[[db.user]]",
                "password": "[[db.pwd]]"
              }
            }
          ]
        }
      },
      "sessionHandler": {
        "module": "lib/session",
        "initMethod": "init",
        "initLevel": 1,
        "options": {
          "app": "ion://application",
          "dataSource": "ion://Db",
          "session": {
            "secret": "ion:demo:secret",
            "resave": false,
            "saveUninitialized": true
          }
        }
      },
      "settings": {
        "module": "core/impl/SettingsRepository",
        "initMethod": "init",
        "initLevel": 1,
        "options": {
          "dataSource": "ion://Db"
        }
      },
      "auth": {
        "module": "lib/auth",
        "initMethod": "init",
        "initLevel": 1,
        "options": {
          "app": "ion://application",
          "logger": "ion://sysLog",
          "dataSource": "ion://Db",
          "denyTopLevel": "[[auth.denyTop]]",
          "authCallbacks": ["[[auth.callback]]"],
          "publicRegistration": "[[auth.registration]]",
          "exclude": ["[[auth.exclude1]]", "[[auth.exclude2]]", "[[auth.exclude3]]"]
        }
      },
      "metaRepo": {
        "module": "core/impl/meta/DsMetaRepository",
        "initMethod": "init",
        "initLevel": 1,
        "options": {
          "dataSource": "ion://Db",
          "sync": {
            "name": "dbSync",
            "module": "core/impl/meta/mongo/dbSync",
            "options": {
              "dataSource": "ion://Db",
              "log": "ion://sysLog"
            }
          }
        }
      },
      "fileStorage": {
        "module": "core/impl/resource/FsStorage",
        "initMethod":"_init",
        "initLevel": 1,
        "options": {
          "storageBase": "[[fs.storageRoot]]",
          "urlBase": "[[fs.urlBase]]",
          "dataSource": "ion://Db"
        }
      },
      "imageStorage": {
        "module": "core/impl/resource/ImageStorage",
        "initLevel": 1,
        "options": {
          "fileStorage": "ion://fileStorage",
          "thumbnails": {
            "tiny": {
              "width": 50,
              "height": 50
            },
            "small": {
              "width": 100,
              "height": 100
            },
            "medium": {
              "width": 300,
              "height": 300
            },
            "preview": {
              "width": 500,
              "height": 500
            }
          }
        }
      },
      "dataRepo": {
        "module": "core/impl/datarepository/ionDataRepository",
        "options": {
          "dataSource": "ion://Db",
          "metaRepository": "ion://metaRepo",
          "fileStorage": "ion://fileStorage",
          "imageStorage": "ion://imageStorage",
          "log": "ion://sysLog",
          "keyProvider": {
            "name": "keyProvider",
            "module": "core/impl/meta/keyProvider",
            "options": {
              "metaRepo": "ion://metaRepo"
            }
          }
        }
      },
      "aclProvider":{
        "module": "core/impl/access/aclmongo",
        "initMethod": "init",
        "initLevel": 1,
        "options":{
          "dataSource": "ion://Db"
        }
      },
      "accessChecker":{
        "module": "core/impl/access/ionAccessChecker",
        "options": {
          "aclProvider": "ion://aclProvider"
        }
      }
    }
}
