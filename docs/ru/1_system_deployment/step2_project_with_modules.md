[Развертывание системы](/docs/ru/1_system_deployment/)  
# Шаг 2 Формирование проекта с модулями
### Предыдущая страница: [Установка окружения](docs/ru/1_system_deployment/step1_installing_environment.md)

## Принципы развертывания
**Внимание:**
* не должно быть в пути русских букв и пробелов
* создаем папку `workspace` в корне `c:\workspace` для размещения приложения


### Клонирование приложения и компонентов

Мы будем рассматривать формирование проекта с модулями на примере `develop-and-test`. Приложение находится в репозитории gitlab - https://git.iondv.ru/dashboard/activity. Набираем искомое приложение `develop-and-test` в поле поиска и переходим на него.

![image](/uploads/1b9bf52d24eaf8100cb254adeaebf152/image.png)

Переходим в репозиторий файлов на ветку `develop`.

![image](/uploads/c86b66e40ce30345a16b21802db5b00a/image.png)

Открываем файл package.json в котором смотрим зависимости.

![image](/uploads/d260a01594567e6f03b89f77f6089f65/image.png)

1. `engines": "ion": 1.8.49` - версия ядра `1.8.49`.  
2. `ionModulesDependencies` - список модулей и их версий.  
3. `ionMetaDependencies` - список других метаданных, необходимых для проекта, в данном случае исключение `viewlib` - библиотека представлений.

#### Получение репозитория ядра
Ядро находится в репозитории [`platform`](https://git.iondv.ru/ION/platform). На главной странице есть поле с путем к репозиторию для гит.

![image](/uploads/f1f838515b040d2a51b933381b320bc1/image.png)

Скопируйте данный адрес, запустите командную строку и в папке `workspace` (переход в папку осуществляется командой `cd c:\workspace`) выполните команду `git clone https://git.iondv.ru/ION/platform.git`. Это команда создает папку `platfform` и в неё клонирует репозиторий. Если приложений несколько, целесообразно будет сразу клонировать в папку назначения с названием нашего приложения, в данном случае dnt. В таком случае команда клонирования репозитория будет выглядить следующим образом - `git clone https://git.iondv.ru/ION/platform.git dnt`.

![image](/uploads/d98115b31f107d56f2e6252cec7792f4/image.png)

При клонировании система запросит учётную запись GitLab. 

Чтобы посмотреть, что папка был создана, набираем команду `dir` - список директорий. Далее переходим в созданную папку командой `cd dnt`.

> Примечание: если после ввода `cd d` нажать кнопку `Tab` - то система автоматически подставит название папки имя которой начинается с `d`. Это удобно когда названия длинные, если нажать ещё несколько раз `Tab` система будет подставлять следующие подходящие названия из списка дирректорий или файлов. 

#### Получение модулей
Переходим в папку модулей командой `cd modules`. Для каждого модуля из списка package.json в свойстве `ionModulesDependencies` - находим по названию репозиторий модуля среди группы модулей https://git.iondv.ru/ION-MODULES и  клонируем каждый модуль. Например, путь для модуля registry - `git clone https://git.iondv.ru/ION-MODULES/registry.git`. Папку назначения модифицировать не нужно. Повторяем для всех модулей. 

![image](/uploads/ad26180dc09ba123b5595ce04d853492/image.png)


#### Получение приложения
Переходим в папку приложения. Если вы находитесь в папке модулей выполняем  команду `cd ..\applications` (можно набрать `cd ..\a` и нажать `Tab`).

После этого возвращаемся на страницу описания репозитория нашего модуля `develop-and-test`, копируем путь к репозиторию и клонируем его
`git clone https://git.iondv.ru/ION-APP/develop-and-test.git`. Папку назначения модифицировать не нужно.

Если есть зависимости в `ionMetaDependencies` - находим их в gitlab и также клонируем эти репозитории в папку `applications`, в частности `viewlib` находится https://git.iondv.ru/ION-METADATA/viewlib, клонируем командой `git clone https://git.iondv.ru/ION-METADATA/viewlib.git`

![image](/uploads/7f01a3c9ff89d8f4d7b5b162194e5a03/image.png)

Наше приложение скомпоновано. Советуем создать проект для него в IDE, например Visual Studio Code и в нём создать конфигурациионный файл.

## Конфигурациионный файл
Конфигурационный файл служит для задания основных параметров окружения приложения и настройки дополнительных параметров запуска.

Вы можете создать конфигурационный файл кликнув правой кнопкой в папке `config` и выбрать `Создать текстовый документ` - не забудьте исправить расширение txt на **ini**. Полный путь файла для примера выше - `c:\workspace\dnt\config\setup.ini`.

![image](/uploads/85aceca6619de495c1b6dbfd1edafc40/image.png)

Открываем файл в редакторе и вставляем содержимое. Самый главный параметр `db.uri=mongodb://127.0.0.1:27017/ion-dnt` он указывает на название базы которую мы будем использовать для приложения. База данных будет создана автоматически.

```
auth.denyTop=false
auth.registration=false
auth.sessionLifeTime=30m
db.uri=mongodb://127.0.0.1:27017/ion-dnt
db.user=
db.pwd=
server.ports[]=8888
server.ports[]=8889
server.ports[]=3000
module.default=registry
fs.storageRoot=./files
fs.urlBase=/files
jobs.enabled=true

```
Пример файла `setup.ini`, который располагается в папке `platform\config` перед использованием требует чтобы из него были удалены все комментарии  начинающиеся со знаков `//`

### Следующая страница: [Шаг 3 Сборка и запуск](/docs/ru/1_system_deployment/step3_building_and_running.md)

--------------------------------------------------------------------------  


 #### [Licence](platform/licence.md)&ensp;  [Contact us](https://iondv.ru/index.html) &ensp;  [ENG](/docs/en/1_system_deployment/step2_project_with_modules.md)   &ensp; [FAQs](/faqs.md)          



--------------------------------------------------------------------------  

 Copyright (c) **IONDV**. All rights reserved. 



