# Геоданные

Тип атрибута **геокоординаты** - является атрибутом, который ведет себя следующим образом:

1. если указан тип геокоординаты в объекте и они заданы, то появляется поле небольшой карты, на которой отображается иконка с координатами, рядом кнопка "Изменить".
2. если данные не заданы - то карта не отображается, отображается только кнопка "Задать координаты" (желательно с крестиком в кружочке - символе сторон света или другой символ карты или координат).
3. "При нажатии на кнопку Задать координаты" или "Изменить" - появляется окно со следующим объектами:
    * с картой, в которой нарисована иконка по кооринатам (если были заданы), определенная по адресу, полученному из объекта (первый приоритетный способ: свойство атрибута links в примере - массив значений указанных полей (если поле ссылочное - то по семантике) или значений (если не совпадают с полями) соединяется в строку, с разделиятелями в виде запятой, второй способ, если не задан links, но задан атрибут "refClass": "" - то семантика отображения указанной ссылки) если такие поля были заданы. Если нет - то иконка не отображается. При этом если щелкнуть на карте в произвольном месте - то в этом месте всплывает окно, в котором предлагается сохранить текущие координаты. Аналогично, при нажатии на иконку - всплывает окно с кнопкой(ссылкой) сохранить, иконка передвигается на место, где был сделан щелчек мышкой.
    * Поле со строкой и кнопкой "Искать" - где можно ввести адрес и появится указанная иконка. Поле автозаполняется одним из вариантов:
       * первый приоритетный способ: свойство атрибута links в примере - массив значений указанных полей (если поле ссылочное - то по семантике) или значений (если не совпадают с полями) соединяются в строку, с разделиятелями в виде запятой,
       * второй способ, если не задан links (не задано, null или пустой массив), но задан атрибут "refClass": "" - то семантика отображения указанной ссылки.
    * Кнопка "сохранить" - при нажатии на которое текущие координаты (автополученные по адресу, либо выбранные при вводе в поле искать, либо полученные по щелчку на запомненные координаты сохраняются в атрибуте
4. Особенности работы от заполнения полей:
    * если задано свойство "autoassigned": true и не заданы данные при создании формы например - то нужно определять координаты автоматически по данным адреса из атрибутов указанных в свойствах геометки

Значение свойства `"type"` у атрибута геокоординат = 100.  

**Варианты хранения** - строка со значениями через запятую, строка в формате JSON с массивом, строка в формет JSON с объектом - как лучше потом передавать в яндекс. Возможно все три типа и определять switch|case по наличию/отсутствию символов '[' или '{' модель разбора и парсить. Непосредственно массив или объект как хранение - нежелательный вариант, т.к. нельзя хранить в mySQL. Действуяющая мета - http://192.168.0.222/ION/khv-svyaz-info/blob/develop/meta/naselenniyPunkt.class.json   
Пример структуры атрибута и модели работы: 
```
{
"orderNumber": 10,
"name": "geo",
"caption": "Геометка",
"type": 100,
"size": null,
"decimals": 0,
"nullable": true,
"readonly": false,
"indexed": false,
"unique": false,
"autoassigned": true, 
"defaultValue": null,
"refClass": "",
"itemsClass": "",
"backRef": "",
"backColl": "",
"binding": "",
"'links":["Россия","city", "street", "building"],
"selConditions": [],
"selSorting": [],
"selectionProvider": {},
"indexSearch": false,
"eagerLoading": false
}
```

## Кодирование способов отображения

У полей тип "Карта" переименован в "Геообъект". У полей такого типа есть три режима отображения `"mode"`:   

* **Карта (0)** - отображаем геообъект на карте,
* **Поиск по адресу (1)** - отображаем геообъект на карте, можем по адресу найти место на карте и переместить туда геообъект, можем задать координаты геообъекта, 
* **Холст (2)** - отображаем геообъект на карте, можем по адресу найти место на карте и переместить туда геообъект, можем задать координаты геообъекта

_Описание и пример выдернуты из_: https://ion-dv.atlassian.net/browse/IONPORTAL-224  
_Кодирование способов отображения выдернуто из комментариев таска_: https://ion-dv.atlassian.net/browse/IONPORTAL-506

### Следующая страница []()
--------------------------------------------------------------------------  


 #### [Licence](/LICENCE.md) &ensp;  [Contact us](https://iondv.com) &ensp;  [English](/README.md)   &ensp; [FAQs](/faqs.md)          



--------------------------------------------------------------------------  

Copyright (c) 2018 **LLC "ION DV"**.
All rights reserved. 