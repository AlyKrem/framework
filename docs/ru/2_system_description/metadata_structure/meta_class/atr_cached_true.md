## Функционал кеширования значений вычисляемых атрибутов и семантик


При применении функционала кеширования, значения атрибутов рассчитываются при создании и изменении объекта. При выборках берутся рассчитанные ранее значения.

Если есть два вычисляемых атрибута (A, B) обращающиеся к коллекции C, и при этом на A настроено кеширование, а на B не настроено, то при редактировании коллекция C будет выдергиваться 2 раза - один раз НА ЛЕТУ для атрибута B на уровне securedDataRepo для проверки доступа, второй раз для атрибута A при его пересчете уже в dataRepo. При чтении объекта из БД в данном случае кеш атрибута A просто не имеет смысла, так как коллекция в любом случае будет выбираться для атрибута B.

### кеширования семантик

Для кеширования семантик объектов в мете класса нужно указать параметр:

```
semanticCached: true
```

Для атрибутов используемых в кешируемых семантиках не выполняется жадная загрузка при выборках. Также в таких семантиках не рекомендуется использовать даты, т.к. они не будут приведены к формату согласно локали и часового пояса пользователя (т.к. кешируются при редактировании объекта на уровне DBAL).

### кеширования значения вычисляемого атрибута

Для кеширования значения вычисляемого атрибута в его мете указываем:

```
cached: true
```

Кроме того реализована возможность обновлять эти кеши у объектов по ссылкам при редактировании основного объекта.

Для этого в мете класса указываем настройку:

```
cacheDependencies: ["refAttr1", "refAttr2.refAttr3", "refAttr2.collAttr4"]
``` 

Т.е. в настройке указываются ссылки и коллекции, кеши объектов в которых надо обновить при редактировании объекта данного класса. Обновления выполняестя рекурсивно. Т.е. если в классе объекта в refAttr1 тоже настроено обновление кешей, оно будет запущено. Настройка наследуется в подклассах.

#### Пример применения настройки:

```json
{
      "orderNumber": 40,
      "name": "kolStatOps",
      "caption": "Количество стационарных ОПС",
      "type": 6,
      "size": null,
      "decimals": 0,
      "allowedFileTypes": null,
      "maxFileCount": 0,
      "nullable": true,
      "readonly": false,
      "indexed": true,
      "unique": false,
      "autoassigned": false,
      "hint": null,
      "defaultValue": null,
      "refClass": "",
      "itemsClass": "",
      "backRef": "",
      "backColl": "",
      "binding": "",
      "semantic": null,
      "selConditions": [],
      "selSorting": [],
      "selectionProvider": null,
      "indexSearch": false,
      "eagerLoading": false,
      "formula": "count($raionObslu.oktmo_nasPunkta.svyaz.ops,&eq($gops, b), 1)",
      "cached": true
    },
```

Кешируется значение данного атрибута, получаемое из формулы. Дополнительно для обновления значения при редактирования объекта необходимо обновлять кеши объектов по ссылке: для это в мете класса каждого объекта по ссылке указываем `cacheDependencies: `, например:

```json
{
  "isStruct": false,
  "key": [
    "okato"
  ],
  "semantic": "name",
  "name": "naselenniyPunkt",
  "version": "",
  "caption": "Населенный пункт",
  "ancestor": null,
  "container": "",
  "creationTracker": "",
  "changeTracker": "",
  "history": 0,
  "journaling": true,
  "compositeIndexes": null,
  "cacheDependencies": ["supOktmo"],
  "properties": [
...
```

### [Источник] (https://ion-dv.atlassian.net/browse/KHVUPRPROJ-70?focusedCommentId=64013&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-64013)

### Следующая страница []()
--------------------------------------------------------------------------  


 #### [Licence](/LICENCE.md) &ensp;  [Contact us](https://iondv.com) &ensp;  [English](/README.md)   &ensp; [FAQs](/faqs.md)          



--------------------------------------------------------------------------  

Copyright (c) 2018 **LLC "ION DV"**.
All rights reserved. 