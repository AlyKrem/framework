# Версионирование
 
 https://ion-dv.atlassian.net/browse/IONPORTAL-280
 
 Теперь есть функционал, который позволяет хранить в системе сразу несколько версий метаданных. Также в каждый объект при изменении и сохранении проставляется его версия. Таким образом уже есть возможность работы с различными версиями одних объектов.  
 Версионирование задается в поле `"version"` основной части меты классов.
 
## Механизм работы
 При закачке метаданных если есть атрибут  version ("version" : 2), то будет закачена мета с версией, иначе версия = 1 
 ```
 {
   "isStruct": false,
   "key": "id",
   "semantic": "caption",
   "name": "ion_filter",
   "caption": "Фильтры",
   "ancestor": null,
   "container": null,
   "creationTracker": "",
   "changeTracker": "",
   "version" : 2
  
 }
 
 ```
 
 И уже далее при создании объектов к ним будет добавляться последняя версия метаданных из текущих в базе, а при редактировании объектов они будут редактироваться на основании сохраненной версии.
 
 Примеры сохраненных объектов с разными версиями в базе (класс фильтра)
 ```
 {
     "_id" : ObjectId("567cfa1eb869fc2833690ea4"),
     "id" : 24006,
     "class" : "ALL",
     "caption" : "11",
     "html" : "",
     "filter" : "[\"{\\\"property\\\":\\\"contact\\\",\\\"operation\\\":20,\\\"value\\\":\\\"11\\\",\\\"title\\\":\\\"Контактная информация содержит 11\\\",\\\"type\\\":7}\"]",
     "period" : "2015-12-08,2016-02-05",
     "version" : 1,
     "semanticTitle" : "11 "
 }
 
 {
     "_id" : ObjectId("56944e5cb73f51ec182c7369"),
     "class" : "ALL",
     "caption" : "fffffff",
     "filter" : "[\"{\\\"property\\\":\\\"class\\\",\\\"operation\\\":0,\\\"value\\\":\\\"fff\\\",\\\"title\\\":\\\"Класс фильтра равно fff\\\",\\\"type\\\":1}\"]",
     "version" : 2,
     "id" : NaN,
     "semanticTitle" : "fffffff "
 }
 ```
 
## Изменения в мете, нужные для работы с версиями
 
 Хотим изменить версию меты, добавляем атрибут  version ("version" : 2) в метаданных и закачка пойдет уже с новой версией
 
 
## Механика работы кода
 
Изначально при считывании данных все данные считываются, но также разделяются по версиям. т.е. класс фильтра с версией 2 в мете можно найти под именем ion_filter_2, также будет в списке и ранняя версия ion_filter_1.  
 
И когда идет выборка объектов, то данные берутся уже с учетом указанной версии. версия объекта передается в качестве параметра при открытии объекта http://localhost:3000/reestr/models/reestr/58431?cls=ion_filter&version=2&imodal=1 ( Здесь открывается объект 58431 в версии 2) http://localhost:3000/reestr/models/reestr/58431?cls=ion_filter&version=1&imodal=1 тоже самое но версия 1. 

### Следующая страница []()
--------------------------------------------------------------------------  


 #### [Licence](/LICENCE.md) &ensp;  [Contact us](https://iondv.com) &ensp;  [English](/README.md)   &ensp; [FAQs](/faqs.md)          



--------------------------------------------------------------------------  

Copyright (c) 2018 **LLC "ION DV"**.
All rights reserved. 