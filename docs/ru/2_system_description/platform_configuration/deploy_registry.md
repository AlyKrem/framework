#### [Оглавление](/docs/ru/index.md)

### Предыдущая страница: [Описание полей deploy.json](/docs/ru/2_system_description/platform_configuration/deploy_desc.md)

# Разворачивание деплоя поверх существующего

Реализована возможность гибкой настройки логики деплоя.

При разворачивании скриптом из `bin` теперь доступны следующие параметры командной строки:

```
--reset - сброс настроек предыдущего деплоя (очистка таблицы настроек)
--sms - при сбросе настроек, не зачищаются настройки помеченные как важные
--rwa - переопределять, а не дополнять массивы
```

При разворачивании с ипользованием `gulp` всегда выполняется очистка настроек предыдущего деплоя с сохранением важных настроек.
При деплое настройки, помеченные как важные, не изменяются. Таким образом появляется возможность сохранять изменения пришедшие из модуля админ, но для этого нужна дополнительная реализация соответствующих разделов модуля админ - чтобы при сохранении настройки помечались как важные.

### Как пометить важные настройки?

На данный момент они помечаются как важные только через `api`. Через настройки в админе настраиваются только расписания. Также в отдельных проектах есть настройки импорта.

`rwa` - опция для разработчиков.

`reset` - опция полностью стирает предыдущие настройки. Если нужно развернуть приложение поверх существующих настроек (например, других развернутых приложений) эта опция не подходит. При этом, чтобы не множились массивы приложений, можно указать настройку `rwa`.

# Параметризация модуля `registry`

### Настройка времени частоты поиска

Задержка поиска отсчитывается после последнего изменения строки. `ENTER` работает всегда, считается как окончание задержки. Если указать `listSearchDelay: 0`, то поиск будет только по `ENTER`.

### Пример

```
"modules": {
    "registry": {
      "globals": {
        "listSearchDelay": 1000
      }
   }
}
```

### Добавление dashboard

В `deploy.json` приложения, в секцию модуля `registry`, добавляем поле `dashboard`, в которой указываем приложения,
а внутри каждого приложения - модули, которые могут отображать данные в контрольной панели.

Модулю можно можно передать кастомные параметры для рендера дашбоард.

### Пример

```
{
  "modules": {
    "registry": {
      "globals": {
        "dashboard": {
          "develop-and-test": {
            "modules": {
              "dashboard": { ... },
              "geomap": { ... }
            }
          }
        }
      }
    },
    "geomap": {
      ...      
    },
    "dashboard": {
      ...
    }
  }
}
```

Указанные модули будут представлены в списке на выбор пользователю. После выбора модуля, страница перегружается (запоминая текущий выбор). Далее, в контроллере подключается выбранный модуль и запрашивается рендер для контрольной панели.
Данный интерфейс реализуется в модуле, чтобы отобразиться на контрольной панели: 

```
require(`module/${moduleName}`).render(Object.assign({
  currentApp, req, res
}, currentModuleParams), (err, result)=> {
  ...
}); 
```

Функционал выбора макета вынесен в модуль дашбоард. При загрузке он подставляет список макетов к спискам модулей. Настройка самих макетов `dashboard` задается в `deploy.json` секция `modules.dashboard`.

```
{
  "modules": {
    "dashboard": {
      "globals": {
        ...
      }
    }  
  }
}
```

### Кеширование ресурсов 

**Кеширование ресурсов** в браузере - указание таймаута на перепроверку статуса `css`, `js`, картинок, шрифтов при загрузке страниц.

`"modules": {"registry": { "globals": {`
```json
staticOptions": {
          "maxAge": 3600000
        },
```

### Кеширование для вычислимых полей

```json
"globals": {
   "plugins":{
     "cachedDataRepo": {
        "options": {
          "cachedClasses": [
            "adress@develop-and-test"
          ]
        }
      }
    }
  }
...
```
## Таймаут обновления статуса объекта

Настройка частоты опроса `notificationCheckInterval`:

```
"registry": {
   "globals": {
      "notificationCheckInterval": 60000 // раз в минуту
   }
}
```

### Следующая страница: [Настройки безопасности - deploy.json](/docs/ru/2_system_description/platform_configuration/deploy_security.md)

--------------------------------------------------------------------------  


 #### [Licence](/LICENCE.md) &ensp;  [Contact us](https://iondv.com) &ensp;  [English](/docs/en/2_system_description/platform_configuration/deploy_registry.md)   &ensp; [FAQs](/faqs.md) 
 
 --------------------------------------------------------------------------  

Copyright (c) 2018 **LLC "ION DV"**.  
All rights reserved. 