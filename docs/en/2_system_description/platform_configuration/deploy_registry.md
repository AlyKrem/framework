#### [Оглавление](/docs/ru/index.md)

### Предыдущая страница: [Описание полей deploy.json](/docs/en/2_system_description/platform_configuration/deploy_desc.md)

# Конфигурационный файл - deploy.json

**Конфигурационный файл deploy.json** - это файл, в котором описывается структура парметров программной системы и её конкретная настройка.

## Настройки разворачивания деплоя поверх существующего

Реализована возможность гибкой настройки логики деплоя.
При разворачивании скриптом из bin теперь доступны параметры командной строки (флаги):
```
--reset - сброс настроек предыдущего деплоя (очистка таблицы настроек)
--sms - при сбросе настроек, не зачищаются настройки помеченные как важные
--rwa - переопределять, а не дополнять массивы
```

При разворачивании с ипользованием "gulp" всегда выполняется очистка настроек предыдущего деплоя с сохранением важных настроек.
При деплое в принципе настройки, помеченные как важные, не изменяются. Таким образом появляется возможность сохранять изменения пришедшие из админки, но для этого нужны отдельные постановки на допил соответствующих разделов админки - чтобы при сохранении настройки помечались как важные.

`Как пометить важные настройки?` Пока они помечаются как важные только через api. Т.е. как раз и нужны постановки по админке и проектам - какие настройки помечать как важные при редактировании. Через настройки в админке сейчас вроде только расписания настраиваются + в отдельных проектах есть настройки импорта (в мониторинге услуг, может быть в госэкспертизе). Проверка по этим таскам будет выглядеть так: развернули, поправили в админке настройку, развернули по новой, убедились, что изменения сохранились.

`rwa` наверное больше для разрабов опция.

`reset` полностью стирает предыдущие настройки. Если нужно накатить приложение поверх существующих настроек (например, других развернутых приложений) эта опция не подходит. При этом, чтобы не множились массивы из накатываемого приложения, можно указать настройку `rwa`. Ну и тут нужно понимать, что если прилага определяет какие-то глобальные массивы, то они затрутся массивами из накатываемых настроек. Для деплоя эта опция смысла особого не имеет.

# Параметризация модуля `registry`

### Настройка времени частоты поиска

Задержка поиска отсчитывается после последнего изменения строки.
ENTER работает всегда, считается как окончание задержки.
Если указать
listSearchDelay: 0
то поиск будет только по ENTER

deploy:
```json
"modules": {
    "registry": {
      "globals": {
        "listSearchDelay": 1000
      }
   }
}
```

### Добавление dashboard

В deploy.json приложения, в секцию модуля регистр,
добавляем секцию dashboard, в которой указываем приложения,
а внутри каждого приложения - модули,
которые могут отображать данные в контрольной панели.
Модулю можно можно передать кастомные параметры для рендера дашбоард.
```json
{
  "modules": {
    "registry": {
      "globals": {
        "dashboard": {
          "develop-and-test": {
            "modules": {
              "dashboard": { ... },
              "geomap": { ... }
            }
          }
        }
      }
    },
    "geomap": {
      ...      
    },
    "dashboard": {
      ...
    }
  }
}
```

Указанные модули будут представлены в списке на выбор юзеру.
После выбора модуля страница перегружается (запоминая текущий выбор).

В контроллере подключается выбранный модуль и запрашивается рендер для контрольной панели.
Данный интерфейс должен быть реализован в модуле, который хочет отрендериться на контрольной панели: 

```
require(`module/${moduleName}`).render(Object.assign({
  currentApp, req, res
}, currentModuleParams), (err, result)=> {
  ...
}); 
```

Функционал выбора макета вынес в модуль дашбоард.
Теперь он при загрузке подсовывает список макетов к спискам модулей.

Настройка самих макетов dashboard осталась прежней - в deploy.json секция modules.dashboard

```
{
  "modules": {
    "dashboard": {
      "globals": {
        ...
      }
    }  
  }
}
```

### Кеширование ресурсов в браузере - указание таймаута на перепроверку статуса css, js, картинок, шрифтов при загрузке страниц

`"modules": {"registry": { "globals": {`
```json
staticOptions": {
          "maxAge": 3600000
        },
```

### Кеширование для вычислимых полей

```json
"globals": {
   "plugins":{
     "cachedDataRepo": {
        "options": {
          "cachedClasses": [
            "adress@develop-and-test"
          ]
        }
      }
    }
  }
...
```
## notificationCheckInterval: таймаут обновления статуса объекта
>  MODREGISTR-481

"registry": {
   "globals": {
      "notificationCheckInterval": 60000 // раз в минуту
   }
}


### Следующая страница: [Настройки безопасности - deploy.json](/docs/ru/2_system_description/platform_configuration/deploy_security.md)

--------------------------------------------------------------------------  


 #### [Licence](/LICENCE.md) &ensp;  [Contact us](https://iondv.com) &ensp;  [English](/docs/en/2_system_description/platform_configuration/deploy.md)   &ensp; [FAQs](/faqs.md) 
 
 --------------------------------------------------------------------------  

Copyright (c) 2018 **LLC "ION DV"**.  
All rights reserved. 